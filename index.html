<!DOCTYPE html>
<html>
<head>
	<title>Help Now</title>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<script src="https://use.fontawesome.com/2a8a6780db.js"></script>
	<script src="https://code.jquery.com/jquery.js"></script>
	
	<style type="text/css">
		
		#form-su,#form-si,#google-su,#google-si,#facebook-su,#facebook-si{
			border-radius:7px;
			color:white;
			font-size:20px;
			display:none;
			margin:1px auto;
		}

		#sign-up,#sign-in{
			font-size:20px;
			font-weight:bold;
		}

		#facebook-su,#facebook-si{
			background-color:#385998;
		}

		#google-su,#google-si{
			background-color:#DD1812;
		}

		#form-su,#form-si{
			background-color:#454545;	
		}

		.socialButtons>button{
			display:inline;
		}

		#errorMsg-su,#errorMsg-si{
			color:red;
		} 

		#sign-up-form,#sign-in-form{
			display:none;
		}

		.instructions{
			margin:0px;
		}

		form>#email-si,form>#phoneNumber-si{
			display:none;
		}
		
		input{
			padding:4px;
			width:100%;
			margin:3px 0px;
		}

	</style>

</head>
<body>
	
	<div id="signUpInButtons" class="text-center">
		<button class="btn btn-default btn-block" id="sign-up">Sign Up</button>
		<button class="btn btn-default btn-block" id="sign-in">Sign In</button>
	</div>

	<button class="btn btn-default btn-block" id="facebook-si">
		<i class="fa fa-facebook"></i><i class="fa fa-fw"></i>Sign In with Facebook
	</button>

	<button class="btn btn-default btn-block" id="google-si">
		<i class="fa fa-google"></i><i class="fa fa-fw"></i>Sign In with Google
	</button>

	<button class="btn btn-default btn-block" id="form-si">
		<i class="fa fa-pencil"></i><i class="fa fa-fw"></i>Sign In with Email and Password
	</button>

	<button class="btn btn-default btn-block" id="facebook-su">
		<i class="fa fa-facebook"></i><i class="fa fa-fw"></i>Sign Up with Facebook
	</button>

	<button class="btn btn-default btn-block" id="google-su">
		<i class="fa fa-google"></i><i class="fa fa-fw"></i>Sign Up with Google
	</button>

	<button class="btn btn-default btn-block" id="form-su">
		<i class="fa fa-pencil"></i><i class="fa fa-fw"></i>Sign Up with Email and Password
	</button>

	<form id="sign-up-form" class="text-center">
		<p id="instructions">Please fill out all fields</p>
		<input id = "firstName-su" type = "text" placeholder="First Name" class="text-center"><!--put a user symbol here-->
		<input id = "lastName-su" type = "text" placeholder="Last Name" class="text-center"><!--put a user symbol here-->
		<input id = "email-su" type = "text" placeholder="Email" class="text-center"><!--put an envelope here-->
		<input id = "phoneNumber-su" type = "text" placeholder="Phone" class="text-center"><!--put a phone icon here-->
		<input id = "password-su" type = "password" placeholder="Password" class="text-center"><!--put a lock here-->
		<button type="button" id = "submit-su">Sign Up</button>
		<div id = "errorMsg-su"></div>
	</form>

	<form id="sign-in-form">
		<p id="instructions">Please provide your registered email and password</p>
		<input id = "email-si" type = "text" placeholder="Email" class="text-center"><!--put an envelope here-->
		<input id = "password-si" type = "password" placeholder="Password" class="text-center"><!--put a lock here-->
		<button type="button" id = "submit-si" class="text-center">Sign In</button>
		<div id = "errorMsg-si"></div>
	</form>

	<script src="https://www.gstatic.com/firebasejs/4.3.1/firebase.js"></script>
	<script type="text/javascript">
		
		var config = {
			apiKey: "AIzaSyBzJ9AknkEz3TmAHLEryoXaT74nLSf9mQQ",
			authDomain: "project1-ad91c.firebaseapp.com",
			databaseURL: "https://project1-ad91c.firebaseio.com",
			projectId: "project1-ad91c",
			storageBucket: "project1-ad91c.appspot.com",
			messagingSenderId: "297815876711"
		};
		firebase.initializeApp(config);

	  	var dB = firebase.database();
	  	var Auth = firebase.auth();
	  	var cloud = firebase.storage();
	  	var provider_fb = new firebase.auth.FacebookAuthProvider();
	  	var provider_goog = new firebase.auth.GoogleAuthProvider();

	  	var user;

	  	$("#sign-in").on("click",function(){
	  		signInUp("si");
	  	})

	  	$("#sign-up").on("click",function(){
	  		signInUp("su");
	  	})

	  	function signInUp(type){
	  		var othertype = type=="su"? "si":"su";
	  		$("#sign-in").css("display","inline");
	  		$("#sign-in").removeClass("btn-block");
	  		$("#sign-in").css("width","49%");
	  		$("#sign-up").css("display","inline");
	  		$("#sign-up").removeClass("btn-block");
	  		$("#sign-up").css("width","49%");
	  		$("#facebook-"+othertype).css("display","none");
	  		$("#google-"+othertype).css("display","none");
	  		$("#form-"+othertype).css("display","none");
	  		$("#facebook-"+type).css("display","block");
	  		$("#google-"+type).css("display","block");
	  		$("#form-"+type).css("display","block");
	  		$("#sign-up-form").css("display","none");
	  		$("#sign-in-form").css("display","none");
	  	}

	  	$("#facebook-su").on("click",function(){
	  		federatedLogin("su",provider_fb);
		})

	  	$("#facebook-si").on("click",function(){
	  		federatedLogin("si",provider_fb);
		})

	  	$("#google-su").on("click",function(){
	  		federatedLogin("su",provider_goog);
		})

	  	$("#google-si").on("click",function(){
	  		federatedLogin("si",provider_goog);
		})

	  	function federatedLogin(type,provider){
		  	firebase.auth().signInWithPopup(provider).then(function(result) {
			  // This gives you a Facebook Access Token. You can use it to access the Facebook API.
			  var token = result.credential.accessToken;
			  // The signed-in user info.
			  user = result.user;
			  console.log(user);
			  // ...
			  if(type=="su"){
				$("form#sign-up-form").prepend("<p>In order to best use our services, please provide a phone number below:</p>");			  	
			  	$("form#sign-up-form").prepend("<p>Welcome " + user.displayName + "</p>");
			  	$("form#sign-up-form").css("display","block");
			  	$("form#sign-up-form>#instructions").css("display","none");
			  	$("form#sign-up-form>#firstName-su").css("display","none");
			  	$("form#sign-up-form>#lastName-su").css("display","none");
			  	$("form#sign-up-form>#email-su").css("display","none");
				$("form#sign-up-form>#password-su").css("display","none");
			  	$("form#sign-up-form>#phoneNumber-su").css("display","block");
			  	$("form#sign-up-form>#submit-su").html("Set Phone");
			  } else {
			  	$("body").append("<p>Welcome " + user.displayName + "</p>");
			  }
			}).catch(function(error) {
			  // Handle Errors here.
			  console.log(error);
			  var errorCode = error.code;
			  console.log(error);
			  var errorMessage = error.message;
			  console.log(errorMessage);
			  // The email of the user's account used.
			  var email = error.email;
			  // The firebase.auth.AuthCredential type that was used.
			  var credential = error.credential;
			  // ...
			});
		}


		$("#form-su").on("click",function(){
			$("#sign-up-form").css("display","block");
			$("input").css("display","block");
			$("#sign-in-form").css("display","none");
		})

		$("#form-si").on("click",function(){
			$("#sign-in-form").css("display","block");
			$("input").css("display","block");
			$("#sign-up-form").css("display","none");
		})


		$("#submit-su").on("click",function(){
			if($("#submit-su").html()!="Set Phone"){
				if($("#firstName-su").val()!=="" && $("#lastName-su").val()!=="" && $("#email-su").val() !== "" && $("#phoneNumber-su").val() !=="" && $("#password-su").val() !== ""){
					if($("#phoneNumber-su").val().length == 12){
						submitForm("su");
					} else {
						$("#errorMsg-su").empty();
						$("#errorMsg-su").append("<p>Please provide a valid phone number.</p>");	
					}
				} else {
					$("#errorMsg-su").empty();
					$("#errorMsg-su").append("<p>Not all fields are filled out correctly. Please fill all forms.</p>");
				}
			} else {
				if($("#phoneNumber-su").val().length == 12){
					pushPhone();
				} else {
					$("#errorMsg-su").empty();
					$("#errorMsg-su").append("<p>Please provide a valid phone number.</p>");	
				}
			}
		})


		$("#submit-si").on("click",function(){
			if($("#email-si").val() !== "" && $("#password-si").val() !== ""){
				submitForm("si");
			} else {
				$("#errorMsg-si").empty();
				$("#errorMsg-si").append("<p>Not all fields are filled out correctly. Please fill all forms.</p>");
			}
		})

		function submitForm(type){
	  		var email = $("#email-" + type).val();
	  		var password = $("#password-" + type).val();
	  		var errorCode="";
		  	Auth.createUserWithEmailAndPassword(email, password).catch(function(error) {
				  // Handle Errors here.
				  errorCode = error.code;
				  var errorMessage = error.message;
				  if(errorMessage == "The email address is already in use by another account."){
				  	$("#errorMsg-" + type).append("<p>" + errorMessage + " If this is your account, please click the sign in button to sign in.</p>")
				  } else {
				  	$("#errorMsg-" + type).append("<p>" + errorMessage + " Please try again.</p>")
				  }
			});
			if (errorCode.length==0){

			}
		}

		$("#phoneNumber-su").on("keydown",function(){
			phoneNumbVal($(this).val(),"#phoneNumber-su");
		})

		phoneNumbVal = function(numb_forValidation,id){
			var e = event || window.event;  // get event object
	    	var key = e.keyCode || e.which;

	    	if (key >= 48 && key <= 57 || key >= 96 && key <= 105) {     
				if(numb_forValidation.length==3||numb_forValidation.length==7){
					$(id).val($(id).val()+"-");
				} else if(numb_forValidation.length == 12){
				   	if (e.preventDefault){
						e.preventDefault();
				        e.returnValue = false;
				    }				
				}
			} else if (key==8){
				if(numb_forValidation.length==5||numb_forValidation.length==9){
					$(id).val($(id).val().substr(0,$(id).val().length-1));
				}			
			} else if (key!=9){
			   	if (e.preventDefault){
					e.preventDefault();
			        e.returnValue = false;
			    }
			}
		}


/*	glyphicon glyphicon-thumbs-up
	glyphicon glyphicon-thumbs-down
*/
	</script>
	
</body>
</html>