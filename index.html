<!DOCTYPE html>
<html>
<head>
	<title>Sign up Form</title>
	<style>

		input{
			display:block;
		}
		
		.socialButtons{
			display:block;
		}

		.socialButtons>button{
			display:inline;
		}

		#errorMsg-su,#errorMsg-si{
			color:red;
		}

		#sign-in{
			display:none;
		}

		.instructions{
			margin:0px;
		}

	</style>

	<!--firebase scripts required-->
	<script src="https://cdn.firebase.com/libs/firebaseui/2.3.0/firebaseui.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.3.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.3.0/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.3.0/firebase-database.js"></script>
	<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.3.0/firebaseui.css" />
	
	<script src="https://code.jquery.com/jquery.js"></script>
</head>
<body>

	<script>
		//facebook login configure
		window.fbAsyncInit = function() {
	    	FB.init({
	      		appId      : '355333268238154',
		      	cookie     : true,
		      	xfbml      : true,
		      	version    : 'v2.10'
		    });
		    FB.getLoginStatus(function(response) {
			    statusChangeCallback(response);
			});  
		};

		(function(d, s, id){
	    	var js, fjs = d.getElementsByTagName(s)[0];
	    	if (d.getElementById(id)) {return;}
	    	js = d.createElement(s); js.id = id;
	    	js.src = "//connect.facebook.net/en_US/sdk.js";
	    	fjs.parentNode.insertBefore(js, fjs);
	   	}(document, 'script', 'facebook-jssdk'));

	   	function statusChangeCallback(response){
	   		if(response.status === 'connected'){
	   			console.log("logged in and authenticated");
	   		} else {
	   			console.log("not authenticated")
	   		}
	   	}
	   	
	   	function checkLoginState(){
	   		FB.getLoginStatus(function(response){
	   			statusChangeCallback(response);
	   		})
	   	}
	</script>

	<!--form-->
	
	<div class="task">
		<button id="su">Sign Up</button>
		<button id="si">Sign In</button>
	</div>
	<form id="sign-up">
		Sign Up with Facebook or Google
		<div class="socialButtons-su">
<!-- 			<fb:login-button 
  id="fb-btn-su"
  scope="email"
  onlogin="checkLoginState();">
</fb:login-button> -->
			<button id = "facebook-su">Google</button>
			<button id = "google-su">Google</button>
		</div>
		<p class="instructions">Or Sign Up with Form Below</p>
		<p class="instructions">Please fill out all fields</p>
		<input id = "email-su" type = "text" placeholder="Email">
		<input id = "phoneNumber-su" type = "text" placeholder="###-###-####">
		<input id = "DOB" type = "date">
		<input id = "password-su" type = "password" placeholder="Password">
		<button type="button" id = "submit-su">Sign Up</button>
		<div id = "errorMsg-su"></div>
	</form>

	<form id="sign-in">
		Sign In with Facebook or Google
		<div class="socialButtons-si">
			<fb:login-button 
			  id="fb-btn-su"
			  scope="email"
			  onlogin="checkLoginState();">
			<button id = "google-si">Google</button>
		</div>
		Or Sign In with Form Below
		<input id = "email-si" type = "text" placeholder="Email">
		<input id = "phoneNumber-su" type = "text" placeholder="###-###-####">
		<input id = "password-si" type = "password" placeholder="Password">
		<button type="button" id = "submit-si">Sign In</button>
		<div id = "errorMsg-si"></div>
	</form>


	<script src="https://www.gstatic.com/firebasejs/4.3.1/firebase.js"></script>
	<script type="text/javascript">
	  // Initialize Firebase
	var config = {
		apiKey: "AIzaSyBzJ9AknkEz3TmAHLEryoXaT74nLSf9mQQ",
		authDomain: "project1-ad91c.firebaseapp.com",
		databaseURL: "https://project1-ad91c.firebaseio.com",
		projectId: "project1-ad91c",
		storageBucket: "project1-ad91c.appspot.com",
		messagingSenderId: "297815876711"
	};
	firebase.initializeApp(config);

	  var dB = firebase.database();
	  var Auth = firebase.auth();
	  var cloud = firebase.storage();
	  var provider = new firebase.auth.FacebookAuthProvider();

	  //federated providers login
	  $("#facebook-su").on("click",function(){
	  	firebase.auth().signInWithPopup(provider).then(function(result) {
		  // This gives you a Facebook Access Token. You can use it to access the Facebook API.
		  var token = result.credential.accessToken;
		  // The signed-in user info.
		  var user = result.user;
		  // ...
		}).catch(function(error) {
		  // Handle Errors here.
		  var errorCode = error.code;
			console.log(error);
		  var errorMessage = error.message;
		  // The email of the user's account used.
		  var email = error.email;
		  // The firebase.auth.AuthCredential type that was used.
		  var credential = error.credential;
		  // ...
		});
	  })



	//////////SIGN UP & SIGN IN FORMS

	var password="";

	$("#password-su").on("keyup",function(){
		passwordEncrypt("su");
	})

	$("#password-si").on("keyup",function(){
		passwordEncrypt("si");
	})

	function passwordEncrypt(type){
		var e = event||window.event;
		var key = e.keyCode;
		var keysNotAllowed = [8,20,16,17,18,27,37,38,39,40,13,113,114];
		if(key!=8){
			password += e.key;
			$("#password-"+type).val(Array(password.length+1).join("*"));
		} else {

		}
	}

  	$("#submit-su").on("click",function(){
  		submitForm("su");
	})

  	$("#submit-si").on("click",function(){
  		submitForm("si");
	})

	function submitForm(type){
  		var email = $("#email-" + type).val();
  		var password = $("#password-" + type).val();
	  	Auth.createUserWithEmailAndPassword(email, password).catch(function(error) {
			  // Handle Errors here.
			  var errorCode = error.code;
			  var errorMessage = error.message;
			  if(errorMessage == "The email address is already in use by another account."){
			  	$("#errorMsg-" + type).append("<p>" + errorMessage + " If this is your account, please click the sign in button to sign in.</p>")
			  } else {
			  	$("#errorMsg-" + type).append("<p>" + errorMessage + " Please try again.</p>")
			  }
		});
	}

  	$("#email-su").on("keyup",function(){
  		writingEmail("su");
  	})

  	$("#email-si").on("keyup",function(){
  		writingEmail("si");
  	})

  	function writingEmail(type){
  		if($("#email-"+type).val().length==1){//want to make sure that the user is entering in a new email, which we can approximate the event by having the length of the input be just 1 character
  			$("#errorMsg-"+type).text("");
  		}
  	}

	var dbObject;//this will be an object that we will read from
		dB.ref().on("value",function(Snapshot){//will constantly refresh dbObject to be most current
		dbObject = Snapshot.toJSON();
	});

	$("#su").on("click",function(){
		
		switchForm("su");	

	})

	$("#si").on("click",function(){

		switchForm("si");

	})

	function switchForm(type){
		var form = type=="su" ? "sign-up" : "sign-in";
		var otherForm = type=="su" ? "sign-in" : "sign-up";
		if($("form#"+form).css("display")!="block"){
			$("#email-" + type).val("");
			$("#password-" + type).val("");
			$("dateOfBirth-" + type).val("");
			$("#phoneNumber-" + type).val("");
			$("#errorMsg-" + type).val("");
			$("form#"+form).css("display","block");
			$("form#"+otherForm).css("display","none");
			password="";
		}
	}


	$("#phoneNumber-si").on("keydown",function(){
		phoneNumbVal($(this).val(),"#phoneNumber-si");
	})

	$("#phoneNumber-su").on("keydown",function(){
		phoneNumbVal($(this).val(),"#phoneNumber-su");
	})

	phoneNumbVal = function(numb_forValidation,id){
		var e = event || window.event;  // get event object
    	var key = e.keyCode || e.which;

    	if (key >= 48 && key <= 57 || key >= 96 && key <= 105) {     
			if(numb_forValidation.length==3||numb_forValidation.length==7){
				$(id).val($(id).val()+"-");
			} else if(numb_forValidation.length == 12){
			   	if (e.preventDefault){
					e.preventDefault();
			        e.returnValue = false;
			    }				
			}
		} else if (key==8){
			if(numb_forValidation.length==5||numb_forValidation.length==9){
				$(id).val($(id).val().substr(0,$(id).val().length-1));
			}			
		} else if (key!=9){
		   	if (e.preventDefault){
				e.preventDefault();
		        e.returnValue = false;
		    }
		}
	}

	</script>


</body>
</html>